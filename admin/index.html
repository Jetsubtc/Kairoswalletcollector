<!DOCTYPE html><html lang="en" data-astro-cid-2zp6q64z> <head><meta charset="utf-8"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.13.9"><title>Admin - Kairos Prediction Game</title><style>@import"https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap";body{background-color:#1a2a6c;color:#fff;min-height:100vh;font-family:"Press Start 2P",system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}*:focus{outline:2px solid #60a5fa;outline-offset:2px}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:#1f2937}::-webkit-scrollbar-thumb{background:#4f46e5;border-radius:4px}::-webkit-scrollbar-thumb:hover{background:#4338ca}
body{background-color:#0f172a;color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;margin:0;padding:20px}.container[data-astro-cid-2zp6q64z]{max-width:1200px;margin:0 auto}.header[data-astro-cid-2zp6q64z]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid #334155}.title[data-astro-cid-2zp6q64z]{font-size:2rem;margin:0}.stats[data-astro-cid-2zp6q64z]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}.stat-card[data-astro-cid-2zp6q64z]{background:#1e293b;padding:20px;border-radius:8px;border:1px solid #334155}.stat-title[data-astro-cid-2zp6q64z]{font-size:.9rem;color:#94a3b8;margin:0 0 10px}.stat-value[data-astro-cid-2zp6q64z]{font-size:1.8rem;font-weight:700;margin:0;color:#60a5fa}.card[data-astro-cid-2zp6q64z]{background:#1e293b;border-radius:8px;padding:25px;margin-bottom:30px;border:1px solid #334155}.card-title[data-astro-cid-2zp6q64z]{font-size:1.5rem;margin-top:0;margin-bottom:20px;color:#e2e8f0}.form-group[data-astro-cid-2zp6q64z]{margin-bottom:20px}.form-label[data-astro-cid-2zp6q64z]{display:block;margin-bottom:8px;font-weight:500}.form-input[data-astro-cid-2zp6q64z]{width:100%;padding:12px;background:#334155;border:1px solid #475569;border-radius:4px;color:#fff;font-size:1rem}.btn[data-astro-cid-2zp6q64z]{background:#3b82f6;color:#fff;border:none;padding:12px 24px;border-radius:4px;cursor:pointer;font-size:1rem;font-weight:500;margin-right:10px}.btn[data-astro-cid-2zp6q64z]:hover{background:#2563eb}.btn[data-astro-cid-2zp6q64z].secondary{background:#64748b}.btn[data-astro-cid-2zp6q64z].secondary:hover{background:#475569}.wallet-table[data-astro-cid-2zp6q64z]{width:100%;border-collapse:collapse;margin-top:20px}.wallet-table[data-astro-cid-2zp6q64z] th[data-astro-cid-2zp6q64z]{text-align:left;padding:12px;background:#334155;border-bottom:2px solid #475569}.wallet-table[data-astro-cid-2zp6q64z] td[data-astro-cid-2zp6q64z]{padding:12px;border-bottom:1px solid #334155}.wallet-table[data-astro-cid-2zp6q64z] tr[data-astro-cid-2zp6q64z]:hover{background:#334155}.message[data-astro-cid-2zp6q64z]{padding:15px;border-radius:4px;margin:20px 0;display:none}.message[data-astro-cid-2zp6q64z].error{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}.message[data-astro-cid-2zp6q64z].success{background:#dcfce7;color:#166534;border:1px solid #bbf7d0}.hidden[data-astro-cid-2zp6q64z]{display:none}.wallet-list-container[data-astro-cid-2zp6q64z]{max-height:500px;overflow-y:auto}
</style></head> <body data-astro-cid-2zp6q64z> <div class="container" data-astro-cid-2zp6q64z> <div class="header" data-astro-cid-2zp6q64z> <h1 class="title" data-astro-cid-2zp6q64z>Admin Dashboard</h1> <button id="logoutBtn" class="btn secondary" data-astro-cid-2zp6q64z>Logout</button> </div> <div id="loginSection" class="card" data-astro-cid-2zp6q64z> <h2 class="card-title" data-astro-cid-2zp6q64z>Admin Login</h2> <form id="loginForm" data-astro-cid-2zp6q64z> <div class="form-group" data-astro-cid-2zp6q64z> <label for="username" class="form-label" data-astro-cid-2zp6q64z>Username</label> <input type="text" id="username" name="username" required class="form-input" data-astro-cid-2zp6q64z> </div> <div class="form-group" data-astro-cid-2zp6q64z> <label for="password" class="form-label" data-astro-cid-2zp6q64z>Password</label> <input type="password" id="password" name="password" required class="form-input" data-astro-cid-2zp6q64z> </div> <button type="submit" class="btn" data-astro-cid-2zp6q64z>Login</button> </form> <div id="loginMessage" class="message" data-astro-cid-2zp6q64z></div> </div> <div id="dashboardSection" class="hidden" data-astro-cid-2zp6q64z> <div class="stats" data-astro-cid-2zp6q64z> <div class="stat-card" data-astro-cid-2zp6q64z> <h3 class="stat-title" data-astro-cid-2zp6q64z>Total Wallets</h3> <p id="walletCount" class="stat-value" data-astro-cid-2zp6q64z>0</p> </div> <div class="stat-card" data-astro-cid-2zp6q64z> <h3 class="stat-title" data-astro-cid-2zp6q64z>Last Updated</h3> <p id="lastUpdated" class="stat-value" data-astro-cid-2zp6q64z>-</p> </div> </div> <div class="card" data-astro-cid-2zp6q64z> <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;" data-astro-cid-2zp6q64z> <h2 class="card-title" data-astro-cid-2zp6q64z>Wallet Submissions</h2> <button id="exportBtn" class="btn" data-astro-cid-2zp6q64z>Export CSV</button> </div> <div class="wallet-list-container" data-astro-cid-2zp6q64z> <table class="wallet-table" data-astro-cid-2zp6q64z> <thead data-astro-cid-2zp6q64z> <tr data-astro-cid-2zp6q64z> <th data-astro-cid-2zp6q64z>User Name</th> <th data-astro-cid-2zp6q64z>Wallet Address</th> <th data-astro-cid-2zp6q64z>Date</th> </tr> </thead> <tbody id="walletTableBody" data-astro-cid-2zp6q64z> <tr data-astro-cid-2zp6q64z> <td colspan="3" style="text-align: center; color: #94a3b8;" data-astro-cid-2zp6q64z>No wallets found</td> </tr> </tbody> </table> </div> </div> </div> </div> <script>
      // Check if already logged in
      const credentials = sessionStorage.getItem('adminCredentials');
      if (credentials) {
        showDashboard();
        loadDashboardData();
      }
      
      // Login form handler
      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const loginMessage = document.getElementById('loginMessage');
        
        try {
          // Encode credentials for Basic Authentication
          const credentials = btoa(`${username}:${password}`);
          
          // Test authentication
          const response = await fetch('/api/admin/wallets', {
            headers: {
              'Authorization': `Basic ${credentials}`
            }
          });
          
          if (response.ok) {
            // Store credentials in sessionStorage for subsequent requests
            sessionStorage.setItem('adminCredentials', credentials);
            showDashboard();
            loadDashboardData();
          } else {
            showMessage(loginMessage, 'Invalid credentials', 'error');
          }
        } catch (error) {
          console.error('Login error:', error);
          showMessage(loginMessage, 'Login failed', 'error');
        }
      });
      
      // Logout handler
      document.getElementById('logoutBtn').addEventListener('click', function() {
        sessionStorage.removeItem('adminCredentials');
        showLogin();
      });
      
      // Export handler
      document.getElementById('exportBtn').addEventListener('click', async function() {
        try {
          const credentials = sessionStorage.getItem('adminCredentials');
          if (!credentials) {
            showLogin();
            return;
          }
          
          const response = await fetch('/api/admin/wallets', {
            headers: {
              'Authorization': `Basic ${credentials}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            if (data.success) {
              // Create CSV content
              let csvContent = "Twitter Handle,Wallet Address,Timestamp\n";
              data.wallets.forEach(wallet => {
                csvContent += `"${wallet.twitterHandle}","${wallet.walletAddress}","${wallet.timestamp}"\n`;
              });
              
              // Create download link
              const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
              const url = URL.createObjectURL(blob);
              const link = document.createElement('a');
              link.setAttribute('href', url);
              link.setAttribute('download', `wallets-${new Date().toISOString().split('T')[0]}.csv`);
              link.style.visibility = 'hidden';
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
            } else {
              alert('Failed to export data: ' + data.message);
            }
          } else {
            alert('Unauthorized. Please login again.');
            showLogin();
          }
        } catch (error) {
          console.error('Export error:', error);
          alert('Export failed');
        }
      });
      
      // Show dashboard
      function showDashboard() {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('dashboardSection').classList.remove('hidden');
      }
      
      // Show login
      function showLogin() {
        document.getElementById('loginSection').classList.remove('hidden');
        document.getElementById('dashboardSection').classList.add('hidden');
        document.getElementById('loginForm').reset();
        document.getElementById('loginMessage').style.display = 'none';
      }
      
      // Show message function
      function showMessage(element, text, type) {
        element.textContent = text;
        element.className = 'message ' + type;
        element.style.display = 'block';
        
        // Hide message after 5 seconds
        setTimeout(() => {
          element.style.display = 'none';
        }, 5000);
      }
      
      // Load dashboard data
      async function loadDashboardData() {
        try {
          const credentials = sessionStorage.getItem('adminCredentials');
          if (!credentials) {
            showLogin();
            return;
          }
          
          const response = await fetch('/api/admin/wallets', {
            headers: {
              'Authorization': `Basic ${credentials}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            if (data.success) {
              document.getElementById('walletCount').textContent = data.count;
              document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
              
              const tableBody = document.getElementById('walletTableBody');
              if (data.wallets.length > 0) {
                tableBody.innerHTML = '';
                // Show all submissions (most recent first)
                const wallets = data.wallets.reverse();
                wallets.forEach(wallet => {
                  const row = document.createElement('tr');
                  
                  // Format the date
                  const date = new Date(wallet.timestamp);
                  const formattedDate = date.toLocaleString();
                  
                  row.innerHTML = `
                    <td>${wallet.twitterHandle}</td>
                    <td style="font-family: monospace;">${wallet.walletAddress}</td>
                    <td>${formattedDate}</td>
                  `;
                  tableBody.appendChild(row);
                });
              } else {
                tableBody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #94a3b8;">No wallets found</td></tr>';
              }
            } else {
              alert('Failed to load data: ' + data.message);
              showLogin();
            }
          } else {
            alert('Unauthorized. Please login again.');
            showLogin();
          }
        } catch (error) {
          console.error('Dashboard load error:', error);
          alert('Failed to load dashboard data');
        }
      }
    </script> </body> </html>